# 2주차: 실시간 배달 추적 시스템 설계

## 📦 시스템 개요

한국의 주요 도시에서 운영되는 음식 배달 플랫폼입니다. 고객이 앱으로 주문하면 근처 라이더를 자동으로 매칭하고, 픽업부터 배달까지 실시간으로 추적할 수 있는 시스템을 설계하세요.

### 🎯 비즈니스 목표

- 평균 배달 시간 30분 이내
- 고객 만족도 향상 (실시간 추적)

## 📋 기능적 요구사항

### 고객 기능

1. **주문하기**
    - 음식점 선택 및 메뉴 주문
    - 배달 주소 입력 (GPS 또는 직접 입력)
    - 예상 도착 시간 확인
2. **실시간 추적**
    - 주문 상태 실시간 업데이트 (주문접수 → 조리중 → 픽업 → 배달중 → 완료)
    - 라이더 실시간 위치 지도에 표시
    - 예상 도착 시간(ETA) 동적 업데이트
3. **알림**
    - 주문 상태 변경 시 푸시 알림(Optional)
    - 라이더 도착 임박 알림 (100m 이내)

### 라이더 기능

1. **배달 수락/거절**
    - 새 배달 요청 알림
    - 배달 정보 확인 (거리, 예상 수익)
    - 15초 내 수락/거절 결정 (Optional)
2. **배달 관리**
    - 최적 경로 제공
    - 상태 업데이트 (픽업 완료, 배달 완료)

### 음식점 기능

1. **주문 관리**
    - 주문 접수/거절
    - 예상 조리 시간 입력
    - 픽업 준비 완료 알림

## 📊 비기능적 요구사항 (수치 포함)

### 규모 (Scale)

```yaml
사용자:
  - 전체 가입자: 3000만명
  - MAU: 1000만명
  - DAU: 300만명
  - 피크 시간 동시 접속: 100만명

라이더:
  - 전체 등록: 100만명
  - 일일 활성: 20만명
  - 피크 시간 활성: 5만명

음식점:
  - 전체 등록: 50만개
  - 일일 활성: 10만개

주문:
  - 일일 주문: 500만건
  - 피크 시간 주문: 10만건/분 (점심 12-1시, 저녁 6-7시)
  - 평균 배달 시간: 30분
```

### 위치 데이터

```yaml
라이더 위치 업데이트:
  - 전송 주기: 5초
  - 피크 시간 라이더: 5만명

고객 위치 조회:
  - 배달 추적 새로고침: 10초마다
  - 동시 추적 고객: 50만명

```

### 성능 요구사항

```yaml
응답 시간:
  - 주문 생성: < 1초
  - 위치 업데이트: < 500ms
  - 매칭 결과: < 2초
  - 지도 로딩: < 2초
  - 알림 전송: < 1초

처리량:
  - 주문 API: 10,000 TPS
  - 위치 업데이트 API: 20,000 TPS
  - 위치 조회 API: 100,000 TPS
  - 매칭 서비스: 5,000 TPS

가용성:
  - 전체 시스템: 99.9% (월 43분 다운타임)
  - 핵심 기능(주문/매칭): 99.95%
  - 부가 기능(추적): 99.5%

```

### 데이터 저장

```yaml
저장 기간:
  - 주문 데이터: 영구 보관
  - 위치 이력: 7일 (법적 요구사항)
  - 상세 위치: 24시간 (5초 단위)
  - 집계 위치: 7일 (1분 단위)

```

## 필수 계산 항목

### 인프라 규모 산정

```markdown
□ 위치 데이터 처리 서버 대수
□ 매칭 엔진 서버 대수
□ API 서버 대수
□ 데이터베이스 용량 및 IOPS
□ Redis 메모리 용량
□ 메시지 큐 처리량

```

## 🏗 아키텍처 설계 포인트

### 1. 위치 데이터 처리

### 2. 실시간 시스템

### 3. 확장성 전략

## 💡 주요 기술적 도전 과제

### 1. 🗺 "Hot Spot 문제"

**문제**: 강남역 같은 특정 지역에 주문과 라이더가 집중

```yaml
강남역 반경 1km:
  - 음식점: 6,000개
  - 피크 시간 주문: 10,000건/분
  - 활성 라이더: 1,000명
  - 위치 업데이트: 200/sec
```

### 2. 🔄 "상태 일관성"

**문제**: 분산 환경에서 주문 상태 동기화

```yaml
상태 전이:
  주문접수 → 조리중 → 픽업대기 → 픽업완료 → 배달중 → 배달완료

동시 업데이트:
  - 고객 앱
  - 라이더 앱
  - 음식점 태블릿
  - 관리자 시스
```

## 고려 안해도 되는 포인트

- 매칭 알고리즘
    - 어떻게 가까운 사람한테 매칭해줄까 기타 등등
- 하나의 라이더가 하나의 음식만 배달한다고 가정
- 알림 관련 부분은 나이브하게 설계해도 괜찮음.
- 중요한것은 어떻게 위치정보를 안정적이고 신뢰성있게 받을수 있을까
- 결제와 같은 외부 의존성은 고려하지 않는다. 
