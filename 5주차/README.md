## 카카오톡 선물하기 시스템 개발하기

## 기능적 요구사항

### 1. 선물 예약 기능

- 사용자는 **특정 날짜/시간**에 선물이 발송되도록 예약할 수 있다
- 예약 가능 기간: **최소 10분 후 ~ 최대 1년 후**
- 발송 시간 지정: **날짜 + 시간** 또는 **날짜만 (기본 00:00)**
- 개인 메시지 첨부 가능 (최대 500자)
- 수신자 정보: 전화번호 또는 카카오톡 ID

### 2. 선물 발송 처리

- 예약 시간에 **정확히 (±1분 이내)** 발송
- 발송 방식: 카카오톡 메시지, SMS, 이메일
- **기프티콘 번호 자동 생성** 및 전달
- 발송 실패 시 **자동 재시도** (최대 3회)

### 3. 선물 수령 및 사용

- 수신자는 메시지 내 링크로 선물 확인
- **30일 내 사용** 기한 (상품별 상이)
- 사용 전 **타인 양도 가능** (1회 한정)
- 미사용 시 **자동 환불** 처리

### 4. 예약 관리 기능

- 예약 내역 **조회 및 상세 확인**
- 발송 **전까지 취소 가능** (취소 수수료 없음)
- 발송 **1시간 전까지 수정 가능** (수신자, 메시지, 시간)
- 예약 상태 실시간 추적

### 5. 알림 기능

- 발송자: 예약 확인, 발송 완료, 수령 확인
- 수신자: 선물 도착, 만료 임박 (D-3, D-1)
- 알림 채널: 앱 푸시, 카카오톡, SMS

### 📊 규모 및 성능 요구사항

| 일 예약 건수 | 5만건 | 50만건 |
| --- | --- | --- |
| 동시 접속자 | 5천명 | 5만명 |
| 시간당 발송 | 2천건 | 2만건 |

### **피크 타임 (실생활 패턴)**

`🎄 12월 (크리스마스): 평소 대비 10배 ↑
💝 2월 14일 (밸런타인데이): 당일 00시 집중 (50배 ↑)
🎂 생일 시즌: 매일 오전 9시, 자정 집중
🧧 설날/추석: 명절 당일 오전 집중`

### **특정 시간대 집중도**

- **자정 (00:00)**: 전체 트래픽의 **30%** (생일 발송)
- **오전 9시**: 전체 트래픽의 **15%** (아침 인사)
- **저녁 8시**: 전체 트래픽의 **10%** (퇴근 시간)

### **성능 요구사항**

- 예약 등록 응답 시간: **500ms 이내**
- 발송 정확도: 예약 시간 **±1분 이내**
- 발송 성공률: **99% 이상**
- 알림 지연 시간: **30초 이내**

## 비기능적 요구사항 (Non-Functional Requirements)

### **정확성 (Accuracy)**

- **발송 시간 준수**: 예약 시간 오차 ±1분 이내
- **중복 발송 방지**: 동일 선물 1회만 발송 (멱등성)
- **결제 정합성**: 예약-발송-환불 금액 일치
- **데이터 일관성**: 예약 정보와 발송 이력 동기화

### **확장성 (Scalability)**

- **수평 확장**: 발송 서버 동적 증설 가능
- **피크 대응**: 평소 대비 **10배 트래픽** 처리
- **지역별 확장**: 글로벌 서비스 고려 (시간대)

### **가용성 (Availability)**

- **서비스 가용률**: **99.9%** 이상
- **장애 복구**: 예약 데이터 유실 방지
- **발송 보장**: 장애 복구 후 놓친 예약 자동 처리
- **Graceful Degradation**: 부분 장애 시 핵심 기능 유지

## **핵심 설계 고민 포인트**

### 💭 **고민 1: 미래 시점 작업 스케줄링**

`수십만 건의 예약을 정확한 시간에 실행하려면?`

### 💭 **고민 2: 피크 시간대 대응**

`자정(00:00)에 수만 건이 동시 발송되어야 한다면?`

### 💭 **고민 3: 취소와 환불 처리**

`발송 직전에 취소 요청이 들어온다면?`

### 💭 **고민 4: 발송 실패 처리**

`발송 실패 시 재시도 전략은?`

### 💭 **고민 5: 시간대(TimeZone) 처리**

`한국에서 미국 친구에게 생일 자정 선물?`
